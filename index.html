<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lampaka Jump - Stabiler Abstand</title>
<style>
  html, body {
    margin: 0; padding: 0;
    background: #87CEFA;
    overflow: hidden;
    user-select: none;
    touch-action: manipulation;
  }
  canvas {
    display: block;
    width: 100vw;
    height: 100vh;
    background: #87CEFA;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
// Canvas Setup
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let width, height;
function resize() {
  width = window.innerWidth;
  height = window.innerHeight;
  canvas.width = width;
  canvas.height = height;
}
window.addEventListener('resize', resize);
resize();

// Spielparameter
const groundHeight = 100; // Höhe des Bodens
const lampakaSize = 80;   // Größe von Lampaka und Kakteen

// Lampaka Objekt
let lampaka = {
  x: width * 0.15,
  y: height - groundHeight - lampakaSize,
  vy: 0,
  jumping: false
};

// Physik & Bewegung
const gravity = 2;
const jumpStrength = -40;
let speed = 3;  // langsamere Geschwindigkeit
let score = 0;
let highscore = localStorage.getItem('highscore') || 0;
let gameOver = false;

// Kakteen
let cacti = [];
const minGap = 700; // Mindestabstand zwischen Kakteen
const maxGap = 1200;

// Bild für Lampaka laden (bitte "Lampaka.png" in gleichen Ordner legen)
const lampakaImg = new Image();
lampakaImg.src = "Lampaka.png";

// Hilfsfunktion: Neuer Kaktus anlegen mit garantiertem Abstand
function spawnCactus() {
  // Letzter Kaktus oder Bildschirmende als Startpunkt
  let lastX = cacti.length > 0 ? cacti[cacti.length - 1].x : width + 200;
  // Abstand zufällig zwischen minGap und maxGap
  let gap = Math.random() * (maxGap - minGap) + minGap;
  // Neuer Kaktus positionieren
  cacti.push({ x: lastX + gap, y: height - groundHeight });
}

// Initial 5 Kakteen generieren
function initCacti() {
  cacti = [];
  let currentX = width + 200;
  for (let i = 0; i < 5; i++) {
    cacti.push({ x: currentX, y: height - groundHeight });
    currentX += Math.random() * (maxGap - minGap) + minGap;
  }
}
initCacti();

// Zeichnet einen Kaktus als grüne Pixel-Form, passend zur Größe
function drawCactus(x, y, size) {
  const w = size * 0.5;
  const h = size;

  ctx.fillStyle = '#228B22';
  // Stamm
  ctx.fillRect(x, y - h, w, h);
  // Linker Arm
  ctx.fillRect(x - w * 0.5, y - h * 0.7, w * 0.5, h * 0.3);
  // Rechter Arm
  ctx.fillRect(x + w, y - h * 0.7, w * 0.5, h * 0.3);
}

// Sprung-Funktion, auf Touch oder Klick reagieren
function jump() {
  if (!lampaka.jumping && !gameOver) {
    lampaka.vy = jumpStrength;
    lampaka.jumping = true;
  }
}
window.addEventListener('touchstart', e => { e.preventDefault(); jump(); }, { passive: false });
window.addEventListener('mousedown', jump);

// Update Logik
function update() {
  if (gameOver) return;

  // Schwerkraft & Bewegung
  lampaka.vy += gravity;
  lampaka.y += lampaka.vy;

  // Auf Boden begrenzen
  if (lampaka.y > height - groundHeight - lampakaSize) {
    lampaka.y = height - groundHeight - lampakaSize;
    lampaka.vy = 0;
    lampaka.jumping = false;
  }

  // Kakteen bewegen
  for (let c of cacti) {
    c.x -= speed;
  }

  // Kakteen entfernen, wenn sie aus dem Bild sind & neuen spawnen
  while (cacti.length > 0 && cacti[0].x + lampakaSize * 0.5 < 0) {
    cacti.shift();
    spawnCactus();
    score++;
    if (score > highscore) {
      highscore = score;
      localStorage.setItem('highscore', highscore);
    }
    // Geschwindigkeit erhöhen alle 5 Punkte
    if (score % 5 === 0) speed += 0.5;
  }

  // Kollision prüfen
  for (let c of cacti) {
    let cactusW = lampakaSize * 0.5;
    let cactusH = lampakaSize;
    if (
      lampaka.x < c.x + cactusW &&
      lampaka.x + lampakaSize > c.x &&
      lampaka.y + lampakaSize > c.y - cactusH
    ) {
      gameOver = true;
      setTimeout(resetGame, 1500);
    }
  }
}

// Spiel zurücksetzen nach Game Over
function resetGame() {
  score = 0;
  speed = 3;
  lampaka.y = height - groundHeight - lampakaSize;
  lampaka.vy = 0;
  lampaka.jumping = false;
  gameOver = false;
  initCacti();
}

// Zeichnen auf Canvas
function draw() {
  ctx.clearRect(0, 0, width, height);

  // Himmel
  ctx.fillStyle = '#87CEFA';
  ctx.fillRect(0, 0, width, height);

  // Boden grün
  ctx.fillStyle = '#228B22';
  ctx.fillRect(0, height - groundHeight, width, groundHeight);

  // Lampaka zeichnen (Bild oder rote Box als Platzhalter)
  if (lampakaImg.complete && lampakaImg.naturalWidth !== 0) {
    ctx.drawImage(lampakaImg, lampaka.x, lampaka.y, lampakaSize, lampakaSize);
  } else {
    ctx.fillStyle = 'red';
    ctx.fillRect(lampaka.x, lampaka.y, lampakaSize, lampakaSize);
  }

  // Kakteen zeichnen
  for (let c of cacti) {
    drawCactus(c.x, c.y, lampakaSize);
  }

  // Punkte und Highscore
  ctx.fillStyle = 'white';
  ctx.font = '30px monospace';
  ctx.fillText(`Punkte: ${score}`, 20, 50);
  ctx.fillText(`Highscore: ${highscore}`, 20, 90);

  // Game Over Overlay
  if (gameOver) {
    ctx.fillStyle = 'rgba(0,0,0,0.5)';
    ctx.fillRect(0, 0, width, height);
    ctx.fillStyle = 'white';
    ctx.font = '80px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('GAME OVER', width / 2, height / 2);
    ctx.textAlign = 'start';
  }
}

// Hauptloop
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();

</script>
</body>
</html>
