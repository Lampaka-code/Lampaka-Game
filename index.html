<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Lampaka Weihnachts-Hüpfer</title>
<style>
  body, html {
    margin: 0; padding: 0; overflow: hidden;
    background: #222;
    display: flex; justify-content: center; align-items: center;
    height: 100vh;
  }
  canvas {
    background: #87CEFA;
    border: 4px solid #000;
    image-rendering: pixelated;
  }
  #startBtn {
    position: absolute;
    top: 20px; right: 20px;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 6px;
    display: none;
    z-index: 10;
  }
</style>
</head>
<body>

<canvas id="game"></canvas>
<button id="startBtn">Nochmal starten</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const startBtn = document.getElementById("startBtn");

let lampakaImg = new Image();
lampakaImg.src = "LAmpaka.png";

let lampaka, gravity, jumpStrength, groundY, speed, score, highscore;
let boxes, boxWidth, boxHeight, minGap, maxGap;
let gameOver = false;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  groundY = canvas.height * 0.8;
}
window.addEventListener("resize", resizeCanvas);

highscore = localStorage.getItem("highscore") || 0;

function initGame() {
  resizeCanvas();

  lampaka = { x: canvas.width * 0.1, y: groundY, vy: 0, jumping: false };
  gravity = canvas.height * 0.004;
  jumpStrength = -canvas.height * 0.015;
  speed = canvas.width * 0.004;
  score = 0;

  boxWidth = canvas.width * 0.04;
  boxHeight = canvas.height * 0.1;
  minGap = canvas.width * 0.15;
  maxGap = canvas.width * 0.3;

  boxes = [];
  for (let i = 0; i < 5; i++) spawnBox();

  gameOver = false;
  startBtn.style.display = "none";
}

function spawnBox() {
  let lastX = boxes.length > 0 ? boxes[boxes.length - 1].x : canvas.width;
  let gap = Math.random() * (maxGap - minGap) + minGap;
  boxes.push({ x: lastX + gap, y: groundY });
}

function jump() {
  if (!lampaka.jumping && !gameOver) {
    lampaka.vy = jumpStrength;
    lampaka.jumping = true;
  }
}

// Touch & Klick zum Springen
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  jump();
});
canvas.addEventListener("mousedown", jump);

function checkCollision() {
  for (let box of boxes) {
    if (
      lampaka.x + lampakaImg.width * 0.4 > box.x &&
      lampaka.x < box.x + boxWidth &&
      lampaka.y + lampakaImg.height * 0.8 > box.y - boxHeight &&
      lampaka.y < box.y
    ) {
      gameOver = true;
      startBtn.style.display = "block";
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("highscore", highscore);
      }
    }
  }
}

function update() {
  if (gameOver) return;

  lampaka.vy += gravity;
  lampaka.y += lampaka.vy;

  if (lampaka.y >= groundY) {
    lampaka.y = groundY;
    lampaka.vy = 0;
    lampaka.jumping = false;
  }

  for (let box of boxes) {
    box.x -= speed;
  }

  if (boxes[0].x + boxWidth < 0) {
    boxes.shift();
    spawnBox();
    score++;
    if (score % 5 === 0) speed += canvas.width * 0.0001;
  }

  checkCollision();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Boden
  ctx.fillStyle = "#228B22";
  ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

  // Lampaka Bild zeichnen (leicht nach oben verschoben für bessere Position)
  ctx.drawImage(lampakaImg, lampaka.x, lampaka.y - lampakaImg.height * 0.8);

  // Kakteen (einfach grüne Rechtecke)
  ctx.fillStyle = "#006400";
  for (let box of boxes) {
    ctx.fillRect(box.x, box.y - boxHeight, boxWidth, boxHeight);
  }

  // Punktestand
  ctx.fillStyle = "#fff";
  ctx.font = `${canvas.height * 0.03}px monospace`;
  ctx.fillText("Punkte: " + score, 10, 30);
  ctx.fillText("Highscore: " + highscore, 10, 60);

  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#fff";
    ctx.font = `${canvas.height * 0.07}px monospace`;
    ctx.textAlign = "center";
    ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2);
    ctx.textAlign = "start";
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

startBtn.addEventListener("click", () => {
  initGame();
});

lampakaImg.onload = () => {
  initGame();
  loop();
};
</script>

</body>
</html>
