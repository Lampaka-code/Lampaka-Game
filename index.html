<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Lampaka Jump</title>
<style>
  html, body {
    margin: 0; padding: 0;
    overflow: hidden;
    background: #87CEFA;
    touch-action: none;
  }
  canvas {
    display: block;
    background: #87CEFA;
  }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let width, height;

function resize() {
  width = window.innerWidth;
  height = window.innerHeight;
  canvas.width = width;
  canvas.height = height;
}
window.addEventListener('resize', resize);
resize();

// Boden-H√∂he (90% vom Canvas-H√∂he)
function getGroundY() {
  return height * 0.9;
}

// Charakter und Kakteen-Gr√∂√üe (gleich gro√ü)
const entitySize = 80;

// Lampaka Bild laden (hier lokal im gleichen Ordner, passe ggf. an)
const lampakaImg = new Image();
lampakaImg.src = "Lampaka.png";

// Lampaka Startposition
let lampaka = {
  x: 150,
  y: 0, // wird gleich auf Boden gesetzt
  vy: 0,
  jumping: false
};

// Physik
const gravity = 1.5;
const jumpStrength = -40; // h√∂herer Sprung
let speed = 4; // langsamer als vorher
let score = 0;
let highscore = localStorage.getItem('highscore') || 0;
let gamePaused = false;

// Kakteen
const cactusWidth = entitySize;
const cactusHeight = entitySize;
const minGap = 400;
const maxGap = 900;
let boxes = [];

function spawnBox() {
  let lastX = boxes.length > 0 ? boxes[boxes.length -1].x : width;
  let gap = Math.floor(Math.random() * (maxGap - minGap) + minGap);
  boxes.push({
    x: lastX + gap,
    y: getGroundY() - cactusHeight
  });
}

// Start mit 5 Kakteen
for(let i=0; i<5; i++) spawnBox();

// Setze Lampaka auf Boden
lampaka.y = getGroundY() - entitySize;

function jump() {
  if (!lampaka.jumping && !gamePaused) {
    lampaka.vy = jumpStrength;
    lampaka.jumping = true;
  }
}

canvas.addEventListener("touchstart", jump);
canvas.addEventListener("mousedown", jump);

function update() {
  if (gamePaused) return;

  lampaka.vy += gravity;
  lampaka.y += lampaka.vy;

  if (lampaka.y >= getGroundY() - entitySize) {
    lampaka.y = getGroundY() - entitySize;
    lampaka.vy = 0;
    lampaka.jumping = false;
  }

  // Kakteen bewegen
  for(let box of boxes) {
    box.x -= speed;
  }

  // Kakteen neu spawnen wenn aus dem Bild
  if (boxes[0].x + cactusWidth < 0) {
    boxes.shift();
    spawnBox();
    score++;
    if(score > highscore) {
      highscore = score;
      localStorage.setItem('highscore', highscore);
    }
    // Geschwindigkeit leicht erh√∂hen alle 5 Punkte
    if(score % 5 === 0) speed += 0.3;
  }

  // Kollision (vereinfacht Rechteck-Kollision)
  for(let box of boxes) {
    if (
      lampaka.x < box.x + cactusWidth &&
      lampaka.x + entitySize > box.x &&
      lampaka.y < box.y + cactusHeight &&
      lampaka.y + entitySize > box.y
    ) {
      gamePaused = true;
      setTimeout(() => {
        // Neustart
        score = 0;
        speed = 4;
        boxes = [];
        for(let i=0; i<5; i++) spawnBox();
        lampaka.y = getGroundY() - entitySize;
        lampaka.vy = 0;
        lampaka.jumping = false;
        gamePaused = false;
      }, 1200);
    }
  }
}

function draw() {
  ctx.clearRect(0, 0, width, height);

  // Himmel (Canvas-Hintergrund ist schon hellblau)

  // Boden
  ctx.fillStyle = "#228B22";
  ctx.fillRect(0, getGroundY(), width, height - getGroundY());

  // Lampaka zeichnen (falls geladen)
  if(lampakaImg.complete && lampakaImg.naturalWidth !== 0) {
    ctx.drawImage(lampakaImg, lampaka.x, lampaka.y, entitySize, entitySize);
  } else {
    // Fallback: rote Box
    ctx.fillStyle = "red";
    ctx.fillRect(lampaka.x, lampaka.y, entitySize, entitySize);
  }

  // Kakteen (gr√ºn)
  ctx.fillStyle = "#006400";
  for(let box of boxes) {
    ctx.fillRect(box.x, box.y, cactusWidth, cactusHeight);
    // Kleine "Arme" der Kakteen
    ctx.fillRect(box.x - cactusWidth*0.2, box.y + cactusHeight*0.3, cactusWidth*0.3, cactusHeight*0.2);
    ctx.fillRect(box.x + cactusWidth*0.9, box.y + cactusHeight*0.3, cactusWidth*0.3, cactusHeight*0.2);
  }

  // Punktestand
  ctx.fillStyle = "white";
  ctx.font = "40px monospace";
  ctx.fillText(`Punkte: ${score}`, 20, 50);
  ctx.fillText(`Highscore: ${highscore}`, 20, 100);

  if(gamePaused) {
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(0, 0, width, height);
    ctx.fillStyle = "white";
    ctx.font = "80px monospace";
    ctx.fillText("üí• Game Over üí•", width/2 - 240, height/2);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
